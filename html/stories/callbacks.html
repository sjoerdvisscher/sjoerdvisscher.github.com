<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
<HEAD>
	<TITLE>w3future.com - article - event handlers and callback functions</TITLE>
	<META NAME="author" CONTENT="Sjoerd Visscher">
	<META NAME="keywords" CONTENT="www, world, wide, web, future, examples, tools, programming, functional, data, model, javascript, soap, xml, rpc, html, mozilla, internet, explorer, netscape, semantic, higher, order, delegates, callback, call-back, event, handler, composition">
	<META NAME="description" CONTENT="The w3future.com article 'Event Handlers and Callback Functions in Javascript' discusses all tricks needed to use object methods ass event handlers or callback functions.">
	<SCRIPT src="/w3f/w3f.js"></SCRIPT>
	<STYLE>
		@import "/w3f/w3f.css";
	</STYLE>
</HEAD>
<BODY>

<TABLE width="100%" height="100%" cellspacing=0 cellpadding=0>
<TR><TD id="header">
<TABLE cellspacing=0 cellpadding=0 style="margin-left:4px"><TR>
<SCRIPT>createSectionButtons()</SCRIPT>
</TR></TABLE>
</TD></TR><TR><TD id="body2">

<TABLE cellpadding=0 cellspacing=2 width="100%" height="100%">
<TR><TD class="sidebar-container">

<TABLE cellpadding=0 cellspacing=0 class="sidebar-container" width="100%">
<TR><TD>

<TABLE cellpadding=0 cellspacing=0 class="sidebar" width="100%">
<TR><TD class="sidebar-header">
Links
</TD></TR>
<SCRIPT>
document.write('<TR><TD>'+createButton({style:'button2',content:'OOP in Javascript, part I',gonew:'http://www.webreference.com/js/column79/'})+'</TD></TR>');
document.write('<TR><TD>'+createButton({style:'button2',content:'OOP in Javascript, part II',gonew:'http://www.webreference.com/js/column80/'})+'</TD></TR>');
document.write('<TR><TD>'+createButton({style:'button2',content:'Delegates vs. Inner Classes',gonew:'http://java.sun.com/docs/white/delegates.html'})+'</TD></TR>');
</SCRIPT>
</TABLE>

</TD></TR>
</TABLE>

</TD><TD id="content">
<H1>Event Handlers and Callback Functions</H1>
<P>In Javascript</P>

<TABLE cellpadding=0 cellspacing=0 width="100%">
<TR><TD>

<H2>Introduction</H2>
<P>In <A href="http://w3future.com/html/stories/hop.html">
Higher Order Programming in Javascript</A> I discussed the various ways of using functions
as values. One particular trick in that document caught the attention of Dan Shappir,
who pointed out to me: "your technique shows how JavaScript supported delegates all 
along, so this is not some great C#/.NET invention." While searching for some more 
information about these delegates, I found out that Microsoft has added them to
Visual J++ too, invoking an <a href="http://java.sun.com/docs/white/delegates.html">
interesting response</a> from Sun, where it's discussed how delegates can much better be
implemented with Inner Classes. As this is aparently a hot issue in other languages, and 
because event handlers and callbacks are useful in webpages too, I decided to write
a new article to discuss this.</P>

<H2>The Trick</H2>
<P>The problem is as follows: Methods use <code>this</code> to refer to the object it is
a method of. But, when using a method as event handler or callback function, 
<code>this</code> does no longer point to that object. The trick is to use the closure like
behaviour of functions, so that the method will always have access to it's object.</P>
<P>Let's look at an example: We want to use a method of an Alerter class as an event 
handler.</P>
<PRE>
  function Alerter(text) {
    this.text=text;
    <B>var me=this;</B>
    this.invoke=function () {
      alert(<B>me</B>.text);
    }
  }

  var sayHi=new Alerter('Hello, world!');
  div.attachEvent('onclick', sayHi.invoke);
</PRE>
<P>So, instead of using <code>this</code>, we use a variable <code>me</code>, that
equals <code>this</code> when the <code>invoke</code> method is created. And, in contrast
to <code>this</code>, <code>me</code> will keep refering to the correct 
<code>Alerter</code> object, even when it's passed as a function to the attachEvent
method of an HTML element.</P>
<H2>Higher Order Programming again</H2>
<P><code>window.setTimeout</code> is an often used function for dynamic webpages.
It waits for a given amount of time, and then calls a callback function.
The above defined <code>sayHi</code> function can be used as a callback function:
<code>setTimeout(sayHi.invoke,2000)</code> will show an alert box after 2 seconds.
But what if we want to be extra cool and show 2 alert boxes after those 2 seconds?
Then we'd have to create a new function that calls both Alerter objects:</P>
<PRE>
  var sayHi=new Alerter('Hello, world!');  
  var sayBye=new Alerter('Bye, world!');
  setTimeout(function() {sayHi.invoke();sayBye.invoke();},2000);
</PRE>
<P>A nice feature of Microsoft's delegates is that you can create a single composite
deligate from several delegates. It looks less messy than inserting an anonymous function.
Let's do that in Javascript too, by extending the function prototype.</P>
<PRE>
  Function.prototype.andThen=function(g) {
    var f=this;
    return function() {
      f();g();
    }
  }
</PRE><P>Now we can write:</P><PRE>
  setTimeout((sayHi.invoke).andThen(sayBye.invoke),2000);
</PRE>
<H3>Several callbacks</H3>
<P>With the <code>andThen</code> method, it becomes very easy to create an object that
allows several other objects to register callbacks.</P>
<PRE>
  function Manager() {
    this.callback=function () {}; // do nothing
    this.registerCallback=function(callbackFunction) {
      this.callback=(this.callback).andThen(callbackFunction);
    }
  }

  var manager=new Manager();
  manager.registerCallback(sayHi.invoke);
  manager.registerCallback(sayBye.invoke);
  manager.callback();
</PRE>
<H2>Conclusion</H2>
<P>With a simple technique event handlers and callback functions become a lot more
interesting in Javascript. As Dan Shappir pointed this out to me, just this morning
(after which I started to write the article), I can't wait to try more of this.
I hope you can't too, and if you've got something to show, don't hesitate to
<A href="mailto:sjoerd@w3future.com">contact me</A>.
</P>
</TD><TD id="note">
<H3>Required knowledge</H3>
<P>You'll have to know how to program object oriented with Javascript.
Read the articles at Webreference (links at the left of the article) to catch up on that.</P>
</TD></TR></TABLE>

</TD></TR></TABLE>

</TD></TR><TR><TD id="footer">
&copy; Copyright <SCRIPT>document.write((new Date()).getFullYear())</SCRIPT> <A href="mailto:sjoerd@w3future.com">Sjoerd Visscher</A>, <A href="http://w3future.com">w3future.com</A>
</TD></TR></TABLE>

<SCRIPT>initButtons()</SCRIPT>
</BODY>
</HTML>
